var ce=Object.create;var $=Object.defineProperty;var de=Object.getOwnPropertyDescriptor;var me=Object.getOwnPropertyNames;var le=Object.getPrototypeOf,ve=Object.prototype.hasOwnProperty;var ue=(o,e)=>{for(var r in e)$(o,r,{get:e[r],enumerable:!0})},V=(o,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of me(e))!ve.call(o,i)&&i!==r&&$(o,i,{get:()=>e[i],enumerable:!(s=de(e,i))||s.enumerable});return o};var l=(o,e,r)=>(r=o!=null?ce(le(o)):{},V(e||!o||!o.__esModule?$(r,"default",{value:o,enumerable:!0}):r,o)),pe=o=>V($({},"__esModule",{value:!0}),o);var z=(o,e,r)=>{if(!e.has(o))throw TypeError("Cannot "+r)};var k=(o,e,r)=>(z(o,e,"read from private field"),r?r.call(o):e.get(o)),I=(o,e,r)=>{if(e.has(o))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(o):e.set(o,r)},E=(o,e,r,s)=>(z(o,e,"write to private field"),s?s.call(o,r):e.set(o,r),r);var Le={};ue(Le,{activate:()=>Be,deactivate:()=>Te});module.exports=pe(Le);var n=l(require("vscode"));var b=l(require("vscode"));var G=l(require("vscode")),Y=require("node:fs/promises");function J(o){return{enableScripts:!0,localResourceRoots:[G.Uri.joinPath(o,"panel-ui")]}}function K(){return{retainContextWhenHidden:!0,enableFindWidget:!0}}function Q(o,e,r,s=3300){return`<!DOCTYPE html>
	<html lang="en">
	
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>\u{1F3AF}</text></svg>">
		<title>Live html preview </title>
        <link rel="stylesheet" href="${e}">
	</head>

	
	<body>
        <style>
            body {
                padding: 0;
                background-color: #fff;
            }
        </style>
            
        <script type="module" src="${o}"></script>
        <address-bar port="${s}"></address-bar>
        <main>
            <iframe id="hostedContent" src="http://localhost:${s}${r}" frameborder="0"></iframe>
        </main>
        
	</body>
	
	</html>`}async function X(o){try{return(await(0,Y.readdir)(o,{withFileTypes:!0})).map(s=>({name:s.name,isDirectory:s.isDirectory()}))}catch{return[]}}var Z=l(require("vscode"));var F=class{constructor(e,r,s){this.webview=e;this.cwd=r;this.console=s;this.handlers={sendDirListing:async e=>{let r=await X(this.cwd+e.dirPath);this.webview.postMessage({type:"completionList",dirListings:r})},openDevTools(){Z.commands.executeCommand("workbench.action.webview.openDeveloperTools")},console:e=>{this.console.write(e.type,e.args)}};e.onDidReceiveMessage(i=>this.handlers[i.command](i))}};var _=l(require("vscode")),ee=(t=>(t[t.trace=1]="trace",t[t.debug=2]="debug",t[t.info=3]="info",t[t.warn=4]="warn",t[t.error=5]="error",t))(ee||{}),we=5,f=class{#e;constructor(e){this.#e=_.window.createOutputChannel(e,"javascript")}write(e,r){ee[e]>=we&&this.#e.show(),this.#e.appendLine(`[${new Date().toLocaleTimeString()}] ${e} ${r}`)}log(e){this.#e.appendLine(e)}dispose(){this.#e.dispose()}};var g,M,a=class{constructor(e,r){I(this,g,void 0);I(this,M,void 0);E(this,g,e),E(this,M,r),k(this,g).onDidDispose(()=>this.dispose(),null)}static openPanel(e,r,s,i,t){if(a.currentPanel){k(a.currentPanel,g).reveal(a.column);return}let v=b.window.createWebviewPanel("liveHTMLPreview","liveHTMLPreview",a.column,{...J(e),...K()});a.currentPanel=new a(v,e),a.closePreview=t;let U=b.Uri.joinPath(e,"panel-ui","address-bar.css"),W=b.Uri.joinPath(e,"panel-ui","address-bar.js"),H=v.webview.asWebviewUri(U),u=v.webview.asWebviewUri(W);v.webview.html=Q(u,H,r,i),a.console=new f("LPS Preview Console"),new F(v.webview,s,a.console)}dispose(){a.currentPanel=void 0,a.closePreview(),a.console.dispose(),k(this,g).dispose()}},y=a;g=new WeakMap,M=new WeakMap,y.column=b.ViewColumn.Two;var S=l(require("vscode"));var O=l(require("vscode")),w=O.workspace.getConfiguration("livePreviewServer.config"),he=O.workspace.getConfiguration("livePreviewServer.custom"),h={liveRefresh:w.get("liveRefresh"),customElementHMR:w.get("customElementHMRectory"),defaultBrowser:w.get("defaultBrowserectory"),serverPort:w.get("serverPort"),baseDir:w.get("baseDir"),compileTs:w.get("compileTs"),updateBrowserPath:w.get("updateBrowserPath"),toolTipBrowsers:w.get("toolTipBrowsers")},oe={httpHeaders:he.get("httpHeaders")};var m={InlinePreview:"livePreviewServer.start.inlinePreview",LaunchChrome:"livePreviewServer.start.chromeBrowser",LaunchBrave:"livePreviewServer.start.braveBrowser",LaunchFirefox:"livePreviewServer.start.firefoxBrowser",LaunchDefault:"livePreviewServer.start.defaultBrowser",StartServer:"livePreviewServer.start.lpsServer",DebugServer:"livePreviewServer.start.debugServer",CloseServer:"livePreviewServer.close.server"},re={Chrome:"livePreviewServer.start.chromeBrowser",Firefox:"livePreviewServer.start.firefoxBrowser",Brave:"livePreviewServer.start.braveBrowser"};var A=class{#e;constructor(){this.#e=S.window.createStatusBarItem(S.StatusBarAlignment.Right,2),this.setStartCommand()}setStartCommand(){this.#e.text="$(globe) Browser",this.#e.tooltip=this.#o(),this.#e.command=m.LaunchDefault,this.#e.show()}#o(){let e=new S.MarkdownString(`Select browser<br>${this.getBrowserList()}`);return e.supportHtml=!0,e.isTrusted=!0,e}getBrowserList(){return h.toolTipBrowsers.map(r=>`&nbsp;&nbsp;&nbsp;&nbsp;[${r}](command:${re[r??m.LaunchDefault]})`).join("<br>")}setCloseCommand(){this.#e.text="Close Server",this.#e.command=m.CloseServer,this.#e.tooltip="close live preview server"}hide(){this.#e.hide()}},C=new A;var se=l(require("vscode")),fe={linux:"xdg-open",win32:"explorer",darwin:"open"},ge={chrome:"start chrome",firefox:"start firefox",brave:"start brave"},be={chrome:"google-chrome",firefox:"firefox",brave:"brave-browser"},Ce={chrome:'open -a "Google Chrome" -g ',firefox:"open -a firefox -g ",brave:'open -a "Brave Browser"'},Pe={linux:be,win32:ge,darwin:Ce};function xe(o,e,r){if(r="http://localhost:"+r,o==="default")return`${fe[e]} ${r}`;let s=`${Pe[e][o]} ${r}`;return e==="linux"&&(s+=" &"),s}function D(o="default",e){let r=se.window.createTerminal("live preview server"),s=xe(o,process.platform,e);r.sendText(s),setTimeout(()=>r.dispose(),1e3)}var te=require("node:fs/promises"),ie=require("node:path"),B=l(require("vscode"));async function Se(o){return new Promise(async(e,r)=>{(0,te.readdir)(o,{withFileTypes:!0}).then(s=>{for(let i of s)i.name.endsWith(".html")&&B.workspace.openTextDocument(`${o}/${i.name}`).then(t=>{B.window.showTextDocument(t).then(v=>e(v.document))})}).catch(s=>r(s))})}async function ne(){let o=B.window.activeTextEditor;if(o.document.languageId!=="html"){let e=(0,ie.dirname)(o.document.fileName);return await Se(e)}return o.document}var P=l(require("vscode"));var De=o=>({type:"chrome",request:"launch",name:"Debug localhost",url:o,webRoot:"${workspaceFolder}"});async function ye(o,e){let r=P.workspace.getConfiguration("launch",P.workspace.workspaceFolders[0].uri),s=r.get("configurations");s.findIndex(t=>t.url===e)===-1&&s.push(De(e)),r.update("configurations",s,P.ConfigurationTarget.WorkspaceFolder).then(()=>{})}async function ae(o,e,r){let s=`http://localhost:${e}${r}`;ye(o,s),P.commands.executeCommand("workbench.action.debug.start"),D("chrome",`${e}${r}`)}var R=n.workspace.workspaceFolders[0].uri.fsPath;async function Be(o){let e=h.serverPort||2200,r,s=n.commands.registerCommand(m.LaunchDefault,async()=>{let c=await u();D("default",`${e}${c}`),C.setCloseCommand()}),i=n.commands.registerCommand(m.LaunchChrome,async()=>{let c=await u();D("chrome",`${e}${c}`),C.setCloseCommand()}),t=n.commands.registerCommand(m.LaunchFirefox,async()=>{let c=await u();D("firefox",`${e}${c}`),C.setCloseCommand()}),v=n.commands.registerCommand(m.InlinePreview,async()=>{let c=await u();y.openPanel(o.extensionUri,c,R,e,N)}),U=n.commands.registerCommand(m.StartServer,async()=>{await u(),C.setCloseCommand()}),W=n.commands.registerCommand(m.DebugServer,async()=>{let c=await u();await ae(R,e,c),C.setCloseCommand()}),H=n.commands.registerCommand(m.CloseServer,()=>{N(),C.setStartCommand()});o.subscriptions.push(s),o.subscriptions.push(i),o.subscriptions.push(t),o.subscriptions.push(U),o.subscriptions.push(W),o.subscriptions.push(v),o.subscriptions.push(H);async function u(){let{PreviewServer:c}=require("../../preview-server/build/server.js"),T=new f("LPS server log"),L=o.extensionPath;if(r=new c(R,L,h,T,oe),e=await r.startServer(e).catch(async d=>console.error(d)),!e)return n.window.showErrorMessage("Cannot start server");let x=await ne().catch(d=>console.error(d));return await new Promise(d=>setTimeout(d,100)),x?(h.liveRefresh&&r.parseLiveRefresher(x),q(),x.fileName.slice(R.length)):n.window.showErrorMessage("docPath not available")}function q(c=!1){if(c){T?.dispose(),L?.dispose(),x?.dispose();return}var T=n.workspace.onDidSaveTextDocument(async d=>{r.reloadOnSave(d)}),L=n.window.onDidChangeActiveTextEditor(async d=>{if(!d)return;let p=d.document;h.liveRefresh&&(p.languageId==="html"||p.languageId==="css")&&r.parseLiveRefresher(p),r.changePageUrl(p)});if(o.subscriptions.push(T),o.subscriptions.push(L),h.liveRefresh){var x=n.workspace.onDidChangeTextDocument(d=>{let{document:p,contentChanges:j}=d;if(j[0])switch(p.languageId){case"html":r.updateElementAtPosition(j[0],p);break;case"css":r.updateRuleAtPosition(j[0],p);break}});o.subscriptions.push(x)}}function N(){q(!0),r?.closeServer()}}function Te(){}0&&(module.exports={activate,deactivate});
